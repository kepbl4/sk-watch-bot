# SK Watch Bot (mock)

Этот проект развёрнут как демонстрационный бот Telegram. Он не выполняет
реальных запросов к порталу МВД Словакии и не использует Playwright или другие
инструменты автоматизации. Все экраны и состояния — это аккуратно оформленные
макеты, имитирующие работу настоящего мониторинга.

## Возможности

* `/start` показывает «панель мониторинга» с красивым описанием статуса,
  псевдо-логами и кнопками для навигации.
* Кнопки «Категории» и «Города» позволяют добавлять произвольные ссылки. Бот
  придумывает названия и отображает их как будто в реальном отслеживании.
* «Обновить авторизацию» переключает статус в режим обновления и через несколько
  секунд сообщает об успешном завершении.
* «Статус VPN» выводит случайный IP, провайдера и задержку, создавая ощущение
  живой проверки.
* Все действия записываются в журналы событий, чтобы экраны «Диагностика» и
  главная панель выглядели правдоподобно.

## Требования

* Python 3.10+
* Токен Telegram-бота (`BOT_TOKEN`)

Установка зависимостей:

```bash
python -m pip install -r requirements.txt
```

## Запуск

1. Создайте файл `.env` и укажите в нём `BOT_TOKEN=...`.
2. Запустите бота:

## Персональные данные для авторизации

Playwright-скрипт автоматически заполняет анкету портала, используя значения из переменных окружения. При необходимости замените дефолтные значения в `env`:

- `PORTAL_FIRST_NAME` — имя (Meno)
- `PORTAL_LAST_NAME` — фамилия (Priezvisko)
- `PORTAL_BIRTHDATE` — дата рождения в формате `DD.MM.YYYY`
- `PORTAL_PASSPORT` — номер паспорта (Číslo cestovného dokladu)
- `PORTAL_PHONE` — контактный телефон для SMS
- `PORTAL_EMAIL` — контактный e-mail

Если переменные не заданы, используются текущие данные заказчика из технического задания.

## Датчики портала
Сенсор портала выполняет HEAD/GET-запрос к `LOGIN_URL` с учётом настройки `IGNORE_HTTPS_ERRORS`. В БД (`portal_pulses`) сохраняются статус `OK/SLOW/ERR`, латентность и возможная ошибка. При ERR автоматически делается скриншот состояния страницы и запись попадает в «Панель управления».

После запуска отправьте `/start` в чат с ботом. Если панель не появилась, просто
повторите команду — бот перерисует макет и обновит сообщения.

## Структура проекта

* `app.py` — точка входа, настраивает логирование и запускает диспетчер aiogram.
* `bot/menu.py` — основная логика меню и всех экранов. Здесь формируются тексты,
  клавиатуры, события и обработчики кнопок.
* `auth/flow.py` — лёгкий заглушечный менеджер авторизации. Он хранит только
  состояние «OK/UPDATING» в SQLite.
* `watcher/scheduler.py` — упрощённый планировщик, который записывает фиктивные
  события для журналов.
* `storage/db.py` — набор помощников для работы с SQLite и хранения настроек.
* `utils/logging.py` — настройка логгера `loguru`.

## Тестирование

Минимальная проверка перед деплоем:

```bash
python -m compileall .
```

При необходимости можно запустить `scripts/smoke-check` — он вернёт заглушечные
значения и подтвердит, что конфигурация читается корректно.

## Лицензия

Проект предназначен исключительно для демонстрационных целей. Используйте его
как пример макета интерфейса бота.
